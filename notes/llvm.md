- `llvm-project`  结构：
    - llvm-project/clang  see:[[clang]]
    - llvm-project/llvm   this note
    - ...
- process of compiling and what llvm does during the process:
    `file.cpp`--- [[clang]] --->`LLVM IR`--- llc --->`LLVM MIR(machine IR)`--- llc  
- CFG(Control Flow Graph):
  - C program -> LLVM-IR:
    - ![图 1](../images/ad85aa0ea77ca0dc45a1af21eb8b49802a5e0c7fde4639f528a872b05ff2123e.png)  
      - -S  给一个可读的IR（人类语言）
      - 产生一个module：
        - datalayout:module 的数据布局
    - IR效果：
      - ![图 2](../images/545fb2c1927308d52160d9a97fac7d7592d490c58be5c00d663fd3e4772de6f0.png)  
    - `LLVM-IR` 结构：
      - llvm:Module： list of global symbols
        - llvm:GlobalVariable（全局变量）
        - llvm:Function（函数 ）:list of basic blocks that form a `CFG`
          - llvm:BasicBlock（基本快[[basicblock]]，以入口开始，出口结束）:list of instructions,terminated by a `branch`（[[branch]]）/`return`/...
            - llvm::Instruction（指令）:typed assembly instruction with operands(操作数)
                  - llvm:ICmplnst(整形cmp)
                  - llvm:BranchInst(分支指令)
    - `LLVM-IR`为`SSA` form(Static Single Assignment form,静态单赋值形式)
    - `LLVM-IR`通常在第一次优化完成后生成MIR([[Machine IR]])
    -变量开头
      - 全局变量以`@`开头
      - 局部变量以`%`开头
      - `basic block` 被调用处以`%`开头
      - `basic block` 定义处以`.`开头
    - 常见误区
      - 控制流 可能是不可约的，不可约流图（[[Loop]]）不会被识别
      - 只有可达的LLVM-IR是SSA的，不可达代码段不会被处理做格式规范
      - 地址空间是指针类型的一部分（不可忽视）
      - null是一个合法指针，即使在0号地址
      - llvm项目不区分有符号和无符号
  - `CodeGen` and `Targets`:
    - `CodeGen`:
       - ![图 4](../images/ba7f29ad8bf2185108fd0dc04b73e4cbe8484c68390fc340e693690ab5d50c81.png)
    - `Targets`:
       - ![图 5](../images/794de21706ca8ab23f6941c38d2d0d28b0f16640cd0c4b2f99f2529fb053921b.png)
       - `Target`  
         - `TargetMachine`包括了Module级别（OS级别的 [[ABI]]） 更低层级别的
         - `Sutarget`包括了函数级别 更低层级别的信息(e.g:[[SSE]]中的指令)
           - `Subtarget`同cpu一起初始化
    - `Machine IR`  (`MIR`)
       - 结构上和LLVM IR类似
       - 依赖LLVM IR constructs 为拓展API构造 `MIR`  
       - 包括了目标依赖和不依赖的 opcpdes,寄存器
       - 可以在LLC程序外生成
       - Instruction Selection and Register Allocation(IR->Machine code/Assembly code) 
         - Instruction pattern 描述了正在执行的内容
         - 3 Instruction Selectors:[[SelectionDAG]],[[FastISel]],[[GlobalISel]]
         - 2 heavily used Register Allocators:`RegAllocFast`,`RegAllocGreedy`
   - Object Generation
     - Assembly "Printing"
     - Assembly "Parsing"


 
[//begin]: # "Autogenerated link references for markdown compatibility"
[clang]: clang.md "clang"
[basicblock]: basicblock.md "BasicBlock"
[branch]: branch.md "Branch"
[Loop]: loop.md "Loop"
[ABI]: abi.md "ABI"
[SSE]: sse.md "SSE"
[SelectionDAG]: selectiondag.md "SelectionDAG"
[FastISel]: fastisel.md "FastISel"
[//end]: # "Autogenerated link references"
